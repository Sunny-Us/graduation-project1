{% extends 'layout.html' %}

{% block title %}ziroom | 个人空间{% endblock %}
{% block link %}
{% parent %}
<link rel="stylesheet" type="text/css" href="css/zone.css">
<link rel="stylesheet" type="text/css" href="third-party/upload_img/cropper/cropper.min.css">
<link rel="stylesheet" type="text/css" href="third-party/upload_img/sitelogo/sitelogo.css">
{% endblock %}
{% block header %}
<div class="default-nav">
  {% block navbar %}
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-default">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="#" class="navbar-brand">
          <img src="images/logo-orange.png" alt="ziroom">
        </a>
      </div>
      <div class="collapse navbar-collapse" id="navbar-default">
        <ul class="nav navbar-nav navbar-right">
          <li class="signin" data-toggle="modal" data-target="#sigin">注册</li>
          <li class="login" data-toggle="modal" data-target="#login">登录</li>
        </ul>
      </div>
    </div>
  </nav>
  {% endblock %}
</div>
{% endblock %}



{% block content %}

<div class="content clearfix">
  <div class="cloud">
    <img src="images/cloud1.png" class="cloud1">
    <img src="images/cloud2.png" class="cloud2">
    <img src="images/cloud3.png" class="cloud3">
  </div>
  <div class="main-container container-fluid">
    <div class="row-fulid">
      <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs nav-stacked left-nav-tabs" role="tablist">
          <li role="presentation" class="left-nav-active active"><a href="#personal_info" aria-controls="personal_info" role="tab" data-toggle="tab">个人信息</a></li>
          <li role="presentation" class="left-nav"><a href="#orders" aria-controls="messages" role="tab" data-toggle="tab">我的订单</a></li>
          <li role="presentation" class="left-nav"><a href="#account" aria-controls="account" role="tab" data-toggle="tab">账户余额</a></li>
        </ul>
      </div>  
      <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10 right-tab-content">
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade in active" id="personal_info">
              <div>
                <!-- 个人信息 tabs -->
                <ul class="nav nav-tabs" role="tablist">
                  <li role="presentation" class="active"><a href="#basc_info" aria-controls="home" role="tab" data-toggle="tab">基本资料</a></li>
                  <li role="presentation"><a href="#change_psd" aria-controls="profile" role="tab" data-toggle="tab">修改密码</a></li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content">
                  <div role="tabpanel" class="tab-pane active" id="basc_info">
                    <div class="ibox-content">
                      <div class="row">
                        <div id="crop-avatar" class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                          <div class="avatar-view" title="Change Logo Picture">
                              <img src="images/upload_logo.jpg" alt="Logo">
                            </div>
                        </div>
                      </div>
                    </div>
                    <!-- 修改头像modal start -->
                    <div class="modal fade" id="avatar-modal" aria-hidden="true" aria-labelledby="avatar-modal-label" role="dialog" tabindex="-1">
                      <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                          <form class="avatar-form" action="{{url('admin/upload-logo')}}" enctype="multipart/form-data" method="post">
                            <div class="modal-header">
                              <button class="close" data-dismiss="modal" type="button">&times;</button>
                              <h4 class="modal-title" id="avatar-modal-label">Change Logo Picture</h4>
                            </div>
                            <div class="modal-body">
                              <div class="avatar-body">
                                <div class="avatar-upload">
                                  <input class="avatar-src" name="avatar_src" type="hidden">
                                  <input class="avatar-data" name="avatar_data" type="hidden">
                                  <label for="avatarInput">图片上传</label>
                                  <input class="avatar-input" id="avatarInput" name="avatar_file" type="file"></div>
                                <div class="row">
                                  <div class="col-md-9">
                                    <div class="avatar-wrapper"></div>
                                  </div>
                                  <div class="col-md-3">
                                    <div class="avatar-preview preview-lg"></div>
                                    <div class="avatar-preview preview-md"></div>
                                    <div class="avatar-preview preview-sm"></div>
                                  </div>
                                </div>
                                <div class="row avatar-btns">
                                  <div class="col-md-9">
                                    <div class="btn-group">
                                      <button class="btn" data-method="rotate" data-option="-90" type="button" title="Rotate -90 degrees"><i class="fa fa-undo"></i> 向左旋转</button>
                                    </div>
                                    <div class="btn-group">
                                      <button class="btn" data-method="rotate" data-option="90" type="button" title="Rotate 90 degrees"><i class="fa fa-repeat"></i> 向右旋转</button>
                                    </div>
                                  </div>
                                  <div class="col-md-3">
                                    <button class="btn btn-success btn-block avatar-save" type="submit"><i class="fa fa-save"></i> 保存修改</button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                    <!-- 修改头像modal end -->

                    <form class="form-horizontal clearfix">
                        <div class="form-group">
                          <label class="col-sm-2 col-lg-2 col-md-2 col-xs-2 col-lg-offset-2 col-md-offset-2 control-label">姓名：</label>
                          <div class="col-sm-10 col-xs-10 col-md-6 col-lg-6">
                            <input type="text" class="info-input" id="name_input">
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-sm-2 col-lg-2 col-md-2 col-xs-2 col-lg-offset-2 col-md-offset-2 control-label">性别：</label>
                          <div class="col-sm-10 col-xs-10 col-md-6 col-lg-6">
                            <input id="gender" type="radio" name="gender" value="1">先生
                            <input id="gender1" type="radio" name="gender" value="2">女士
                          </div>
                        </div>
                        <div class="form-group">
                          <label for="service-data" class="col-sm-2 col-lg-2 col-md-2 col-xs-2 col-lg-offset-2 col-md-offset-2 control-label">联系方式：<span class="important">*</span></label>
                          <div class="col-sm-10 col-xs-10 col-md-6 col-lg-6">
                            <input id="tel_input" class="info-input" type="text" />
                          </div>
                        </div>
                        <div class="form-group">
                          <label for="service-time" class="col-sm-2 col-lg-2 col-md-2 col-xs-2 col-lg-offset-2 col-md-offset-2 control-label">居住地址:<span class="important">*</span></label>
                          <div class="col-sm-10 col-xs-10 col-md-6 col-lg-6">
                            <input class="info-input" type="text" id="address_input">
                          </div>
                        </div>
                       
                        <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                          <button type="button" class="btn btn-warning" id="submit_baseInfo">修改信息</button>
                        </div>
                    </form>
                  </div>
                  <div role="tabpanel" class="tab-pane" id="change_psd">
                    <form class="form-horizontal clearfix">
                        <div class="form-group">
                          <label class="col-sm-2 col-lg-2 col-md-2 col-xs-2 col-lg-offset-2 col-md-offset-2 control-label">原密码：</label>
                          <div class="col-sm-10 col-xs-10 col-md-6 col-lg-6">
                            <input id="old_psd" type="text" class="info-input">
                            <p class="psd-warning">密码输入错误</p>
                          </div>
                        </div>
                        <div class="form-group">
                          <label for="service-data" class="col-sm-2 col-lg-2 col-md-2 col-xs-2 col-lg-offset-2 col-md-offset-2 control-label">新密码：</label>
                          <div class="col-sm-10 col-xs-10 col-md-6 col-lg-6">
                            <input id="new_psd" class="info-input" type="password" />
                          </div>
                        </div>
                        <div class="form-group">
                          <label for="service-time" class="col-sm-2 col-lg-2 col-md-2 col-xs-2 col-lg-offset-2 col-md-offset-2 control-label">重新输入密码:</label>
                          <div class="col-sm-10 col-xs-10 col-md-6 col-lg-6">
                            <input id="reinput_psd" class="info-input" type="password">
                            <p class="reinput-warning">两次输入的密码不一样</p>
                          </div>
                        </div>
                       
                        <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                          <button type="submit" class="btn btn-warning" id="submit_psd">修改密码</button>
                        </div>
                    </form>
                  </div>
                </div>

              </div>
            </div>


            <div role="tabpanel" class="tab-pane" id="orders">
               <div>
                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                  <li role="presentation" class="active"><a href="#ordering" aria-controls="home" role="tab" data-toggle="tab">正在进行订单</a></li>
                  <li role="presentation"><a href="#ordered" aria-controls="profile" role="tab" data-toggle="tab">历史订单</a></li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content">
                  <div role="tabpanel" class="tab-pane active" id="ordering">
                    <ul class="clearfix">
                      <li class="order-list" onclick="javascript:openNext('zone_detail');">
                        <div class="row-fluid">
                            <section class="order-item">
                              <span class="order-name">马桶维修</span>
                              <span class="order-state">已下单...</span>  <span class="order-time">预约时间：03月29号  9:00-18:00 </span>
                              <input type="button" value="删除" class="delete-order-btn">
                              <input type="button" value="修改" class="modify-order-btn">
                              <!-- <span class="order-people">上门师傅：姚素娟</span> -->
                            </section>   
                        </div>
                      </li>
                      <li class="order-list" onclick="javascript:openNext('zone_detail');">
                        <div class="row-fluid">
                            <section class="order-item">
                              <span class="order-name">马桶维修</span>
                              <span class="order-state">已受理...</span>  <span class="order-time">预约时间：03月29号  9:00-18:00 </span><span class="order-people">上门师傅：姚素娟</span>
                            </section>   
                        </div>
                      </li>
                      <li class="order-list" onclick="javascript:openNext('zone_detail');">
                        <div class="row-fluid">
                            <section class="order-item">
                              <span class="order-name">马桶维修</span>
                              <span class="order-state">进行中...</span>  <span class="order-time">预约时间：03月29号  9:00-18:00 </span><span class="order-people">上门师傅：姚素娟</span>
                            </section>   
                        </div>
                      </li>
                    </ul>
                  </div>
                  <div role="tabpanel" class="tab-pane" id="ordered">
                    <ul class="clearfix">
                      <li class="order-list" onclick="javascript:openNext('zone_detail');">
                        <div class="row-fluid">
                            <section class="ordered-item">
                              <span class="ordered-name">马桶维修</span>
                              <span class="ordered-state">已结束</span>  <span class="ordered-time">预约时间：03月29号  9:00-18:00 </span>
                              <span class="ordered-people">上门师傅：姚素娟</span>
                              <input type="button" class="evaluate-btn" value="待评价">
                            </section>   
                        </div>
                      </li>
                      <li class="order-list" onclick="javascript:openNext('zone_detail');">
                        <div class="row-fluid">
                            <section class="ordered-item">
                              <span class="ordered-name">马桶维修</span>
                              <span class="ordered-state">已结束</span>  <span class="ordered-time">预约时间：03月29号  9:00-18:00 </span><span class="ordered-people">上门师傅：姚素娟</span>
                              <input type="button" class="evaluated-btn" value="已评价" disabled>
                            </section>   
                        </div>
                      </li>
                      <li class="order-list" onclick="javascript:openNext('zone_detail');">
                        <div class="row-fluid">
                            <section class="ordered-item">
                              <span class="ordered-name">马桶维修</span>
                              <span class="ordered-state">已结束</span>  <span class="ordered-time">预约时间：03月29号  9:00-18:00 </span><span class="ordered-people">上门师傅：姚素娟</span>
                              <input type="button" class="evaluated-btn" value="已评价" disabled>
                            </section>   
                        </div>
                      </li>
                    </ul>
                  </div>
                </div>

              </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="account">
                  <div class="balance">
                   

                  </div> 
            </div>
          </div>
      </div>
    </div>  
  </div>
  <div class="bottom-flower">
  </div>
 </div>
{% endblock %}
{% block footer %}
  {% parent %}
  {% block script%}
    {% parent %}
    <script type="text/javascript" src="third-party/upload_img/cropper/cropper.min.js"></script>
    <script type="text/javascript" src="third-party/upload_img/sitelogo/sitelogo.js"></script>
    <script type="text/javascript">
      $(function(){
        //--------------初始化页面
        var strUrl=window.location.href;
        // console.log(strUrl);
        var id=strUrl.split("#")[1];
        // console.log(id);
        function getPagesInfo(data){
          $("#name_input").attr("value",data.data[0].name);
          $("#tel_input").attr("value",data.data[0].phone);
          $("#address_input").attr("value",data.data[0].address);
          switch(data.data[0].gender){
            case '0':break;
            case '1':$("#gender").prop("checked","checked");break;
            case '2':$("#gender1").prop("checked","checked");break;
          }
          $(".balance").html(" 您的账户余额为 "+data.data[0].balance+" 元");
        }
        function getPsd(data){
          var oldPsd=$.md5(data.data[0].password);
          var newPsd=$.md5($("#old_psd").val());
          if(oldPsd==newPsd){
            $(".psd-warning").css("display","none");
            $("#submit_psd").on("click",function(){
              changePsd();
            });
          }else{
            $(".psd-warning").css("display","block");
            $("#submit_psd").unbind("click");
          }
        }
        function initial(id,operation){
          var uid=parseInt(id);
          var token = $.cookie("key");
          $.ajax({
            url:"http://127.0.0.1:8081/user/user",
            type:"post",
            data:{"method":"query","id":uid,"token":token},
            success:function(data){
              if(operation=="getPagesInfo"){
                getPagesInfo(data);
              }else if(operation == "getPsd"){
                getPsd(data);
              }
            }
          });
        }
        initial(id,"getPagesInfo");
        //-----------修改信息
        function modifyInfo(name,phone,gender,address){
          // console.log(name,phone,gender,address);
          var cookie=$.cookie("key");
          $.ajax({
            url:"http://127.0.0.1:8081/user/user",
            type:"post",
            data:{"method":"update","token":"cookie","data":JSON.stringify([{"2":{"name":name,"phone":phone,"gender":gender,"address":address}}])},
            success:function(data){
              if(data.result){
                alert("修改信息成功");
              }
              
            },
            erro:function(data){
              // console.log(data);
              alert("修改信息失败");
            }
          });
        }
        $("#submit_baseInfo").on("click",function(){
          var newname=$.trim($("#name_input").val());
          var newtel=$.trim($("#tel_input").val());
          var newgender=$.trim($('input:radio[name="gender"]:checked').val());
          // console.log("newgender",newgender);
          var newaddress=$.trim($("#address_input").val());
          modifyInfo(newname,newtel,newgender,newaddress);
        });
        //-------------修改密码
        function changePsd(){
          var cookie=$.cookie("key");
          var newpsd=$.trim($("#new_psd").val());
          $.ajax({
            url:"http://127.0.0.1:8081/user/user",
            type:"post",
            data:{"method":"update","token":"cookie","data":JSON.stringify([{"2":{"password":newpsd}}])},
            success:function(data){
              if(data.result){
                alert("修改信息成功");
              }
              
            },
            erro:function(data){
              // console.log(data);
              alert("修改信息失败");
            }
          });
        }
        $("#old_psd").on("blur",function(){
          initial(id,"getPsd");
        });
        $("#reinput_psd").on("blur",function(){
          var repsd=$.trim($(this).val());
          var newpsd=$.trim($("#new_psd").val());
          if(repsd==newpsd){
            $(".reinput-warning").css("display","none");
             $("#submit_psd").on("click",function(){
              changePsd();
            });
          }else{
            $(".reinput-warning").css("display","block");
            $("#submit_psd").unbind("click");
          }
        });

        $("#submit_psd").on("click",function(){
          changePsd();
        });

      });
  </script>
  {% endblock %}
{% endblock%}