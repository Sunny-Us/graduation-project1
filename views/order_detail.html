{% extends 'layout.html' %}

{% block title %}ziroom | 订单详情{% endblock %}
{% block link %}
{% parent %}
<link rel="stylesheet" type="text/css" href="css/zone.css">
<link rel="stylesheet" type="text/css" href="third-party/upload_img/cropper/cropper.min.css">
<link rel="stylesheet" type="text/css" href="third-party/upload_img/sitelogo/sitelogo.css">
{% endblock %}
{% block header %}
<div class="default-nav">
  {% block navbar %}
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-default">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="#" class="navbar-brand">
          <img src="images/logo-orange.png" alt="ziroom">
        </a>
      </div>
      <div class="collapse navbar-collapse" id="navbar-default">
        <ul class="nav navbar-nav navbar-right">
          <li class="signin" data-toggle="modal" data-target="#sigin">注册</li>
          <li class="login" data-toggle="modal" data-target="#login">登录</li>
        </ul>
      </div>
    </div>
  </nav>
  {% endblock %}
</div>
{% endblock %}



{% block content %}

<div class="content clearfix">
  <div class="cloud">
    <img src="images/cloud1.png" class="cloud1">
    <img src="images/cloud2.png" class="cloud2">
    <img src="images/cloud3.png" class="cloud3">
  </div>
  <div class="main-container container-fluid">
    <div class="bread-nav">
      <a href="zone" class="bread-nav-item">我的账单</a><em></em>
      <a href="javascript:;" class="bread-nav-item">正在进行中的订单</a><em></em>
      <a href="javascript:;" class="bread-nav-item-active">马桶维修</a>
    </div>
    <div class="container-fluid order-state-wrap">
      <div class="row-fluid order-state clearfix">
        <div class="circle-icon circle-icon-active" id="take_order"></div>
        <div class="line-icon line-icon-active"></div>
        <div class="circle-icon" id="accepted"></div>
        <div class="line-icon"></div>
        <div class="circle-icon" id="ongoing"></div>
        <div class="line-icon"></div>
        <div class="circle-icon" id="order_finished"></div>
      </div>
      <div class="row-fluid clearfix service-person-info">
        <div class="col-lg-3 service-info-left">
          <img src="images/service_person.png" class="service-person-img">
          <div class="service-person-indetail">
            <section class="service-person-name">姚小瑶</section>
            <section class="service-tel">
              联系电话：18612345678
            </section>
          </div>
          
        </div>
        <div class="col-lg-8 service-info-right">
          <section class="detail-book-time">预约时间：2016.04.11 9:00-18:00</section>
          <section class="detail-finish-time">完成时间：2016.04.11 12:35</section>
          <section class="detail-service-address">服务地址：北京市朝阳区芍药居**号院**号楼**单元***室</section>
          <section class="detail-order-num">订单号：mtwx2016041111</section>
          <section class="detail-receive-people">验收人：马小跳</section>
          <!-- 已完成订单待评价 -->
          <section style="" class="to-evaluate">评价：
            <span class="star-icon"></span>
            <span class="star-icon"></span>
            <span class="star-icon"></span>
            <span class="star-icon"></span>
            <span class="star-icon"></span>
            <button type="submit" class="evaluate-btn">评价</button>
          </section>
          <!-- 已完成订单已评价 -->
          <section style="display:none">
            评价：
            <span class="star-icon-active"></span>
            <span class="star-icon-active"></span>
            <span class="star-icon-active"></span>
            <span class="star-icon-active"></span>
            <span class="star-icon"></span>
            <input type="button" class="evaluated-btn" value="已评价" disabled>
          </section>
        </div>
      </div>
    </div>
  </div>
  <div class="bottom-flower">
  </div>
 </div>
{% endblock %}
{% block footer %}
  {% parent %}
  {% block script%}
    {% parent %}
    <script type="text/javascript" src="third-party/upload_img/cropper/cropper.min.js"></script>
    <script type="text/javascript" src="third-party/upload_img/sitelogo/sitelogo.js"></script>
    <script>
      $(function(){
        function initialOrderDetail(){
          var url=window.location.href;
          console.log(url);
          var urlarr=url.split("#");
          var orderStatus=parseInt(urlarr[2]);
          var orderId=parseInt(urlarr[1]);
          //先判断状态 start 
          var allLineIcon=$(".line-icon");
          var allCircleIcon=$(".circle-icon");
          allCircleIcon.removeClass("circle-icon-active");
          var circleLength=allCircleIcon.length;
          var lineLength=allLineIcon.length;
          console.log(lineLength);
          if(orderStatus>2){
            for(var i=0;i<lineLength;i++){
              allLineIcon.eq(i).addClass("line-icon-active");
            }
          }else{
            allLineIcon.removeClass("line-icon-active");
            for(var j=0;j<orderStatus;j++){
               allLineIcon.eq(i).addClass("line-icon-active");
            }
          }
          for(var a=0;a<orderStatus;a++){
            allCircleIcon.eq(a).addClass("circle-icon-active");
          }
          //先判断状态 end
          //请求订单详情 start
          var token=$.cookie("key");
          $.ajax({
              url:"http://127.0.0.1:8081/order",
              type:"post",
              data:{
                "method":"query",
                "order_id":orderId,
                "token":token
              },
              success:function(data){
                console.log(data);
                $(".service-person-name").html(data.data[0].worker_id.name);
                $(".service-tel").html("联系电话："+data.data[0].worker_id.phone);
                $(".detail-book-time").html("预约时间："+data.data[0].book_time);
                $(".detail-finish-time").html("完成时间："+data.data[0].finish_time);
                $(".detail-service-address").html("服务地址："+data.data[0].service_address);
                $(".detail-receive-people").html("验收人："+$.cookie("uname"));
              }
          });
                  
                 
          //请求订单详情 end

        }
        initialOrderDetail();
      });
    </script>
  {% endblock %}
{% endblock%}